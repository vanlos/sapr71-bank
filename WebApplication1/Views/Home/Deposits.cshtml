
@{
    ViewBag.Title = "Deposits";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

@*<style>
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 25px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }
    </style>*@
<h3>Найдите свой вклад</h3>
<form action="" method="post">
    <table class="table table-bordered">
        <tr>
            <td>Сумма вклада</td>
            <td>
                <input type="text" name="sum" id="sum" />
                <input type="range" min="0" max="1000000" step="10000" id="sumRange" oninput="updateSum(this.value)" class="slider" />
            </td>
            <td>Срок вклада</td>
            <td>
                <select name="Limit" id="Limit" @*onchange="if (this.selectedIndex) { search() }"*@>
                    <option>любой</option>
                    @foreach (var d in ViewBag.Deposits)
                    {
                        //if (ViewBag.limit == null)
                        //{
                          <option value="@d.limit"> @d.limit </option>
                            //}
                        @*else
                        {
                            if (ViewBag.limit == d.limit)
                            {
                                <option value="@d.limit"> @d.limit </option>
                            }
                        }*@
                    }
                </select>
            </td>
        </tr>
        <tr>
            <td><input type="submit" value="Найти" /></td>
        </tr>
    </table>
</form>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#Limit").on("change", function () {
            var limit = $('#Limit').find("option:selected").val();
            SearchData(limit)
        });
    });
    function SearchData(limit) {
        if (limit == 'любой') {
            $('#deposits tbody tr').show();
        } else {
            $('#deposits tbody tr:has(td)').each(function () {
                var rowLimit = $.trim($(this).find('td:eq(5)').text());
            if ($(this).find('td:eq(5)').text() != '' || $(this).find('td:eq(5)').text() != '') {
                    if (limit != 'любой') {
                        if (rowLimit.toUpperCase() == limit.toUpperCase()) {
                            $(this).show();
                        } else {
                            $(this).hide();
                        }
                    }
                }

            });
        }
    }
</script>
<script>
    function updateSum(val) {
        document.getElementById('sum').value = val;
    }
</script>
@*<script>
    function search() {
        var input, filter, table, tr, td, i;
        input = document.getElementById("Limit");
        filter = input.value;
        table = document.getElementById("deposits");
        tr = table.getElementsByTagName("tr");
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[5];
            if (td) {
                if (td.innerHTML.indexOf(filter) > -1) {
                    tr[i].style.display = "";
                }
                else {
                    tr[i].style.display = "none";
                }
            }

        }
    }
</script>*@
<script>
    var usedNames = {};
    $("select[name='Limit'] > option").each(function () {
        if (usedNames[this.text]) {
            $(this).remove();
        } else {
            usedNames[this.text] = this.value;
        }
    });
</script>
<form action="" method="get">
    <input type="submit" value="Обновить">
</form>
<div class="row">
    <div class="col-md-6">
        <h3 align="center">Предложения по вкладам</h3>
        <table class="table table-bordered" align="center" id="deposits">
            <tbody>
                <tr>
                    <th width="300px"><p>Банк</p></th>
                    <th width="300px"><p>Название вклада</p></th>
                    <th width="300px"><p>Ставка</p></th>
                    <th width="400px"><p>Минимальная Сумма</p></th>
                    <th width="400px"><p>Максимальная Сумма</p></th>
                    <th width="400px"><p>Срок</p></th>
                </tr>
                @foreach (var d in ViewBag.Deposits)
                {
                    if (ViewBag.sum1 == null && ViewBag.limit == null)
                    {
                        <tr>
                            <td width="300px"><p>@d.bank</p></td>
                            <td width="300px"><p>@d.title</p></td>
                            <td width="300px"><p>@d.rate</p></td>
                            <td width="400px"><p>@d.sum</p></td>
                            <td width="400px"><p>@d.sum2</p></td>
                            <td width="400px"><p>@d.limit</p></td>
                        </tr>
                    }
                    else if (ViewBag.sum1 >= d.sum && d.sum2 >= ViewBag.sum1 && (ViewBag.limit == d.limit || ViewBag.limit == null))
                    {
                        <tr>
                            <td width="300px"><p>@d.bank</p></td>
                            <td width="300px"><p>@d.title</p></td>
                            <td width="300px"><p>@d.rate</p></td>
                            <td width="400px"><p>@d.sum</p></td>
                            <td width="400px"><p>@d.sum2</p></td>
                            <td width="400px"><p>@d.limit</p></td>
                        </tr>
                    }
                }
            </tbody>
        </table>
        <button>
            @Html.ActionLink("Калькулятор вкладов", "DepositCalc", "Home")
        </button>


    </div>
</div>
